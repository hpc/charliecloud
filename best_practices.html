<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>12. Best practices &mdash; Charliecloud 0.38 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="13. Contributor’s guide" href="dev.html" />
    <link rel="prev" title="11. Frequently asked questions (FAQ)" href="faq.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Charliecloud
              <img src="_static/logo-sidebar.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.38
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">1. Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">2. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-checkns.html">3. <code class="code docutils literal notranslate"><span class="pre">ch-checkns</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-completion.bash.html">4. <code class="code docutils literal notranslate"><span class="pre">ch-completion.bash</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-convert.html">5. <code class="code docutils literal notranslate"><span class="pre">ch-convert</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-fromhost.html">6. <code class="code docutils literal notranslate"><span class="pre">ch-fromhost</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-image.html">7. <code class="code docutils literal notranslate"><span class="pre">ch-image</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-run.html">8. <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-run-oci.html">9. <code class="code docutils literal notranslate"><span class="pre">ch-run-oci</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch-test.html">10. <code class="code docutils literal notranslate"><span class="pre">ch-test</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">11. Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">12. Best practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#other-best-practices-information">12.1. Other best practices information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filesystems">12.2. Filesystems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metadata-traffic">12.2.1. Metadata traffic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-copy-performance">12.2.2. File copy performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installing-your-own-software">12.3. Installing your own software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#third-party-software-via-package-manager">12.3.1. Third-party software via package manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#third-party-software-compiled-from-source">12.3.2. Third-party software compiled from source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#your-software-stored-in-the-image">12.3.3. Your software stored in the image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#your-software-stored-on-the-host">12.3.4. Your software stored on the host</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mpi">12.4. MPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#problems-that-best-practices-help-you-avoid">12.4.1. Problems that best practices help you avoid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recommendations-tl-dr">12.4.2. Recommendations TL;DR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-libfabric">12.4.3. Use libfabric</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choose-a-compatible-pmi">12.4.4. Choose a compatible PMI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choose-an-mpi-compatible-with-your-libfabric-and-pmi">12.4.5. Choose an MPI compatible with your libfabric and PMI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">13. Contributor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Charliecloud</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">12. </span>Best practices</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="best-practices">
<h1><span class="section-number">12. </span>Best practices<a class="headerlink" href="#best-practices" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#other-best-practices-information" id="id1">Other best practices information</a></p></li>
<li><p><a class="reference internal" href="#filesystems" id="id2">Filesystems</a></p>
<ul>
<li><p><a class="reference internal" href="#metadata-traffic" id="id3">Metadata traffic</a></p></li>
<li><p><a class="reference internal" href="#file-copy-performance" id="id4">File copy performance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installing-your-own-software" id="id5">Installing your own software</a></p>
<ul>
<li><p><a class="reference internal" href="#third-party-software-via-package-manager" id="id6">Third-party software via package manager</a></p></li>
<li><p><a class="reference internal" href="#third-party-software-compiled-from-source" id="id7">Third-party software compiled from source</a></p></li>
<li><p><a class="reference internal" href="#your-software-stored-in-the-image" id="id8">Your software stored in the image</a></p></li>
<li><p><a class="reference internal" href="#your-software-stored-on-the-host" id="id9">Your software stored on the host</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mpi" id="id10">MPI</a></p>
<ul>
<li><p><a class="reference internal" href="#problems-that-best-practices-help-you-avoid" id="id11">Problems that best practices help you avoid</a></p></li>
<li><p><a class="reference internal" href="#recommendations-tl-dr" id="id12">Recommendations TL;DR</a></p></li>
<li><p><a class="reference internal" href="#use-libfabric" id="id13">Use libfabric</a></p></li>
<li><p><a class="reference internal" href="#choose-a-compatible-pmi" id="id14">Choose a compatible PMI</a></p></li>
<li><p><a class="reference internal" href="#choose-an-mpi-compatible-with-your-libfabric-and-pmi" id="id15">Choose an MPI compatible with your libfabric and PMI</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="other-best-practices-information">
<h2><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">12.1. </span>Other best practices information</a><a class="headerlink" href="#other-best-practices-information" title="Permalink to this heading">¶</a></h2>
<p>This isn’t the last word. Also consider:</p>
<ul class="simple">
<li><p>Many of Docker’s <a class="reference external" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices">Best practices for writing Dockerfiles</a>
apply to Charliecloud images as well.</p></li>
<li><p>“<a class="reference external" href="https://f1000research.com/articles/7-742/v2">Recommendations for the packaging and containerizing of bioinformatics
software</a>”, Gruening et al.
2019, is a thoughtful editorial with eleven specific containerization
recommendations for scientific software.</p></li>
<li><p>“<a class="reference external" href="https://nvlpubs.nist.gov/nistpubs/specialpublications/nist.sp.800-190.pdf">Application container security guide</a>”,
NIST Special Publication 800-190; Souppaya, Morello, and Scarfone 2017.</p></li>
</ul>
</section>
<section id="filesystems">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">12.2. </span>Filesystems</a><a class="headerlink" href="#filesystems" title="Permalink to this heading">¶</a></h2>
<p>There are two performance gotchas to be aware of for Charliecloud.</p>
<section id="metadata-traffic">
<h3><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">12.2.1. </span>Metadata traffic</a><a class="headerlink" href="#metadata-traffic" title="Permalink to this heading">¶</a></h3>
<p>Directory-format container images and the Charliecloud storage directory often
contain, and thus Charliecloud must manipulate, a very large number of files.
For example, after running the test suite, the storage directory contains
almost 140,000 files. That is, metadata traffic can be quite high.</p>
<p>Such images and the storage directory should be stored on a filesystem with
reasonable metadata performance. Notably, this <em>excludes</em> Lustre, which is
commonly used for scratch filesystems in HPC; i.e., don’t store these things
on Lustre. NFS is usually fine, though in general it performs worse than a
local filesystem.</p>
<p>In contrast, SquashFS images, which encapsulate the image into a single file
that is mounted using FUSE at runtime, insulate the filesystem from this
metadata traffic. Images in this format are suitable for any filesystem,
including Lustre.</p>
</section>
<section id="file-copy-performance">
<span id="best-practices-file-copy"></span><h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">12.2.2. </span>File copy performance</a><a class="headerlink" href="#file-copy-performance" title="Permalink to this heading">¶</a></h3>
<p><code class="code docutils literal notranslate"><span class="pre">ch-image</span></code> does a lot of file copying. The bulk of this is manipulating
images in the storage directory. Importantly, this includes <a class="reference internal" href="ch-image.html#ch-image-bu-large"><span class="std std-ref">large files</span></a> stored by the build cache outside its Git repository,
though this feature is disabled by default.</p>
<p>Copies are costly both in time (to read, transfer, and write the duplicate
bytes) and space (to store the bytes). However significant optimizations are
sometimes available. Charliecloud’s internal file copies (unfortunately not
sub-programs like Git) can take advantage of multiple optimized file-copy
paths offered by Linux:</p>
<dl class="simple">
<dt>in-kernel copy</dt><dd><p>Copy data inside the kernel without passing through user-space. Saves time
but not space.</p>
</dd>
<dt>server-side copy</dt><dd><p>Copy data on the server without sending it over the network, relevant only
for network filesystems. Saves time but not space.</p>
</dd>
<dt>reflink copy (best)</dt><dd><p>Copy-on-write via “<a class="reference external" href="https://blog.ram.rachum.com/post/620335081764077568/symlinks-and-hardlinks-move-over-make-room-for">reflink</a>”.
The destination file gets a new inode but shares the data extents of the
source file — i.e., no data are copied! — with extents unshared later
if/when are written. Saves both time and space (and potentially quite a
lot).</p>
</dd>
</dl>
<p>To use these optimizations, you need:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Python ≥3.8, for <code class="code docutils literal notranslate"><span class="pre">os.copy_file_range()</span></code> (<a class="reference external" href="https://docs.python.org/3/library/os.html#os.copy_file_range">docs</a>), which
wraps <code class="code docutils literal notranslate"><span class="pre">copy_file_range(2)</span></code> (<a class="reference external" href="https://man7.org/linux/man-pages/man2/copy_file_range.2.html">man page</a>), which
selects the best method from the three above.</p></li>
<li><p>A new-ish Linux kernel (details vary).</p></li>
<li><p>The right filesystem.</p></li>
</ol>
</div></blockquote>
<p>The following table summarizes our (possibly incorrect) understanding of
filesystem support as of October 2023. For current or historical information,
see the <a class="reference external" href="https://elixir.bootlin.com/linux/latest/A/ident/remap_file_range">Linux source code</a> for
in-kernel filesystems or specific filesystem release nodes, e.g. <a class="reference external" href="https://github.com/openzfs/zfs/releases">ZFS</a>. A checkmark ✅ indicates
supported, ❌ unsupported. We recommend using a filesystem that supports
reflink and also (if applicable) server-side copy.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>in-kernel</p></th>
<th class="head"><p>server-side</p></th>
<th class="head"><p>reflink (best)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p><em>local filesystems</em></p></td>
</tr>
<tr class="row-odd"><td><p>BTRFS</p></td>
<td><p>✅</p></td>
<td><p>n/a</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-even"><td><p>OCFS2</p></td>
<td><p>✅</p></td>
<td><p>n/a</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-odd"><td><p>XFS</p></td>
<td><p>✅</p></td>
<td><p>n/a</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-even"><td><p>ZFS</p></td>
<td><p>✅</p></td>
<td><p>n/a</p></td>
<td><p>✅ [1]</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p><em>network filesystems</em></p></td>
</tr>
<tr class="row-even"><td><p>CIFS/SMB</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-odd"><td><p>NFSv3</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
</tr>
<tr class="row-even"><td><p>NFSv4</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>✅ [2]</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p><em>other situations</em></p></td>
</tr>
<tr class="row-even"><td><p>filesystems not listed</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
</tr>
<tr class="row-odd"><td><p>copies between filesystems</p></td>
<td><p>❌ [3]</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>As of <a class="reference external" href="https://github.com/openzfs/zfs/releases/tag/zfs-2.2.0">ZFS 2.2.0</a>.</p></li>
<li><p>If the underlying exported filesystem also supports reflink.</p></li>
<li><p>Recent kernels (≥5.18 as well as stable kernels if backported) support
in-kernel file copy between filesystems, but for many kernels it is <a class="reference external" href="https://man7.org/linux/man-pages/man2/copy_file_range.2.html#BUGS">not
stable</a>, so
Charliecloud does not currently attempt it.</p></li>
</ol>
</div></blockquote>
</section>
</section>
<section id="installing-your-own-software">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">12.3. </span>Installing your own software</a><a class="headerlink" href="#installing-your-own-software" title="Permalink to this heading">¶</a></h2>
<p>This section covers four situations for making software available inside a
Charliecloud container:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Third-party software installed into the image using a package manager.</p></li>
<li><p>Third-party software compiled from source into the image.</p></li>
<li><p>Your software installed into the image.</p></li>
<li><p>Your software stored on the host but compiled in the container.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Maybe you don’t have to install the software at all. Is there already a
trustworthy image on Docker Hub you can use as a base?</p>
</div>
<section id="third-party-software-via-package-manager">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">12.3.1. </span>Third-party software via package manager</a><a class="headerlink" href="#third-party-software-via-package-manager" title="Permalink to this heading">¶</a></h3>
<p>This approach is the simplest and fastest way to install stuff in your image.
The <code class="code docutils literal notranslate"><span class="pre">examples/hello</span></code> Dockerfile does this to install the package
<code class="code docutils literal notranslate"><span class="pre">openssh-client</span></code>:</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">RUN</span><span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--setopt<span class="o">=</span><span class="nv">install_weak_deps</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span>openssh-clients<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>dnf<span class="w"> </span>clean<span class="w"> </span>all

<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>hello
</pre></div>
</div>
<p>You can use distribution package managers such as <code class="code docutils literal notranslate"><span class="pre">dnf</span></code>, as demonstrated
above, or others, such as <code class="code docutils literal notranslate"><span class="pre">pip</span></code> for Python packages. Be aware that the
software will be downloaded anew each time you execute the instruction (unless
you add an HTTP cache, which is out of scope of this documentation).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RPM and friends (<code class="code docutils literal notranslate"><span class="pre">yum</span></code>, <code class="code docutils literal notranslate"><span class="pre">dnf</span></code>, etc.) have traditionally been
rather troublesome in containers, and we suspect there are bugs we haven’t
ironed out yet. If you encounter problems, please do file a bug!</p>
</div>
</section>
<section id="third-party-software-compiled-from-source">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">12.3.2. </span>Third-party software compiled from source</a><a class="headerlink" href="#third-party-software-compiled-from-source" title="Permalink to this heading">¶</a></h3>
<p>Under this method, one uses <code class="code docutils literal notranslate"><span class="pre">RUN</span></code> commands to fetch the desired software
using <code class="code docutils literal notranslate"><span class="pre">curl</span></code> or <code class="code docutils literal notranslate"><span class="pre">wget</span></code>, compile it, and install. Our example
(<code class="code docutils literal notranslate"><span class="pre">examples/Dockerfile.almalinux_8ch</span></code>) does this with ImageMagick:</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">almalinux:8</span>

<span class="c"># This image has three purposes: (1) demonstrate we can build a AlmaLinux 8</span>
<span class="c"># image, (2) provide a build environment for Charliecloud EPEL 8 RPMs, and (3)</span>
<span class="c"># provide image packages necessary for Obspy and Paraview.</span>
<span class="c">#</span>
<span class="c"># Quirks:</span>
<span class="c">#</span>
<span class="c">#   1. Install the dnf ovl plugin to work around RPMDB corruption when</span>
<span class="c">#      building images with Docker and the OverlayFS storage driver.</span>
<span class="c">#</span>
<span class="c">#   2. Enable PowerTools repo, because some packages in EPEL depend on it.</span>
<span class="c">#</span>
<span class="c">#   3. Install packages needed to build el8 rpms.</span>
<span class="c">#</span>
<span class="c">#   4. Issue #1103: Install libarchive to resolve cmake bug</span>
<span class="c">#</span>
<span class="c">#   5. AlmaLinux lost their GPG key, so manual intervention is required to</span>
<span class="c">#      install current packages [1].</span>
<span class="c">#</span>
<span class="c"># [1]: https://almalinux.org/blog/2023-12-20-almalinux-8-key-update/</span>
<span class="k">RUN</span><span class="w"> </span>rpm<span class="w"> </span>--import<span class="w"> </span>https://repo.almalinux.org/almalinux/RPM-GPG-KEY-AlmaLinux
<span class="k">RUN</span><span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--setopt<span class="o">=</span><span class="nv">install_weak_deps</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">                </span>epel-release<span class="w"> </span><span class="se">\</span>
<span class="w">                </span><span class="s1">&#39;dnf-command(config-manager)&#39;</span>
<span class="k">RUN</span><span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--enable<span class="w"> </span>powertools
<span class="k">RUN</span><span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--setopt<span class="o">=</span><span class="nv">install_weak_deps</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">                </span>dnf-plugin-ovl<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>autoconf<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>automake<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>gcc<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>libarchive<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>libpng-devel<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>make<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>python3<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>python3-devel<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>python3-lark-parser<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>python3-requests<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>python3-sphinx<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>python3-sphinx_rtd_theme<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>rpm-build<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>rpmlint<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>rsync<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>squashfs-tools<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>squashfuse<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>wget<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>which<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>dnf<span class="w"> </span>clean<span class="w"> </span>all

<span class="c"># Need wheel to install bundled Lark, and the RPM version doesn’t work.</span>
<span class="k">RUN</span><span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>wheel

<span class="c"># AlmaLinux&#39;s linker doesn’t search these paths by default; add them because we</span>
<span class="c"># will install stuff later into /usr/local.</span>
<span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;/usr/local/lib&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/ld.so.conf.d/usrlocal.conf<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;/usr/local/lib64&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/ld.so.conf.d/usrlocal.conf<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ldconfig

<span class="c"># Install ImageMagick</span>
<span class="c"># The latest, 7.1.0, fails to install with a cryptic libtool error. ¯\_(ツ)_/¯</span>
<span class="k">ARG</span><span class="w"> </span><span class="nv">MAGICK_VERSION</span><span class="o">=</span><span class="m">7</span>.0.11-14
<span class="k">RUN</span><span class="w"> </span>wget<span class="w"> </span>-nv<span class="w"> </span>-O<span class="w"> </span>ImageMagick-<span class="si">${</span><span class="nv">MAGICK_VERSION</span><span class="si">}</span>.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;https://github.com/ImageMagick/ImageMagick/archive/refs/tags/</span><span class="si">${</span><span class="nv">MAGICK_VERSION</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tar<span class="w"> </span>xf<span class="w"> </span>ImageMagick-<span class="si">${</span><span class="nv">MAGICK_VERSION</span><span class="si">}</span>.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>ImageMagick-<span class="si">${</span><span class="nv">MAGICK_VERSION</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./configure<span class="w"> </span>--prefix<span class="o">=</span>/usr/local<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>-j<span class="w"> </span><span class="k">$(</span>getconf<span class="w"> </span>_NPROCESSORS_ONLN<span class="k">)</span><span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-Rf<span class="w"> </span>../ImageMagick-<span class="si">${</span><span class="nv">MAGICK_VERSION</span><span class="si">}</span>

<span class="c"># Add mount points for files and directories for paraview and obspy comparison</span>
<span class="c"># tests.</span>
<span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>/diff<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;example bind mount file&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/a.png<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;example bind mount file&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/b.png
</pre></div>
</div>
<p>So what is going on here?</p>
<ol class="arabic simple">
<li><p>Use the latest AlmaLinux 8 as the base image.</p></li>
<li><p>Install some packages using <code class="code docutils literal notranslate"><span class="pre">dnf</span></code>, the OS package manager, including
a basic development environment.</p></li>
<li><p>Install <code class="code docutils literal notranslate"><span class="pre">wheel</span></code> using <code class="code docutils literal notranslate"><span class="pre">pip</span></code> and adjust the shared library
configuration. (These are not needed for ImageMagick but rather support
derived images.)</p></li>
<li><p>For ImageMagick itself:</p>
<ol class="arabic simple">
<li><p>Download and untar. Note the use of the variable <code class="code docutils literal notranslate"><span class="pre">MAGICK_VERSION</span></code>
and versions easier.</p></li>
<li><p>Build and install. Note the <code class="code docutils literal notranslate"><span class="pre">getconf</span></code> trick to guess at an
appropriate parallel build.</p></li>
<li><p>Clean up, in order to reduce the size of the build cache as well as the
resulting Charliecloud image (<code class="code docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-Rf</span></code>).</p></li>
</ol>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because it’s a container image, you can be less tidy than you might
normally be. For example, we install ImageMagick directly into
<code class="code docutils literal notranslate"><span class="pre">/usr/local</span></code> rather than using something like <a class="reference external" href="https://www.gnu.org/software/stow/">GNU Stow</a> to organize this directory tree.</p>
</div>
</section>
<section id="your-software-stored-in-the-image">
<h3><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">12.3.3. </span>Your software stored in the image</a><a class="headerlink" href="#your-software-stored-in-the-image" title="Permalink to this heading">¶</a></h3>
<p>This method covers software provided by you that is included in the image.
This is recommended when your software is relatively stable or is not easily
available to users of your image, for example a library rather than simulation
code under active development.</p>
<p>The general approach is the same as installing third-party software from
source, but you use the <code class="code docutils literal notranslate"><span class="pre">COPY</span></code> instruction to transfer files from the
host filesystem (rather than the network via HTTP) to the image. For example,
<code class="code docutils literal notranslate"><span class="pre">examples/mpihello/Dockerfile.openmpi</span></code> uses this approach:</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="c"># ch-test-scope: full</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">openmpi</span>

<span class="c"># This example</span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>/hello
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/hello</span>
<span class="k">RUN</span><span class="w"> </span>make<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make
</pre></div>
</div>
<p>These Dockerfile instructions:</p>
<ol class="arabic">
<li><p>Copy the host directory <code class="code docutils literal notranslate"><span class="pre">examples/mpihello</span></code> to the image at path
<code class="code docutils literal notranslate"><span class="pre">/hello</span></code>. The host path is relative to the <em>context directory</em>, which
is tarred up and sent to the Docker daemon. Docker builds have no access to
the host filesystem outside the context directory.</p>
<p>(Unlike HPC, Docker comes from a world without network filesystems. This
tar-based approach lets the Docker daemon run on a different node from the
client without needing any shared filesystems.)</p>
<p>The usual convention, including for Charliecloud tests and examples, is
that the context is the directory containing the Dockerfile in question. A
common pattern, used here, is to copy in the entire context.</p>
</li>
<li><p><code class="code docutils literal notranslate"><span class="pre">cd</span></code> to <code class="code docutils literal notranslate"><span class="pre">/hello</span></code>.</p></li>
<li><p>Compile our example. We include <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> to remove any leftover
build files, since they would be inappropriate inside the container.</p></li>
</ol>
<p>Once the image is built, we can see the results. (Install the image into
<code class="code docutils literal notranslate"><span class="pre">/var/tmp</span></code> as outlined in the tutorial, if you haven’t already.)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ch-run<span class="w"> </span>/var/tmp/mpihello-openmpi.sqfs<span class="w"> </span>--<span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span>/hello
<span class="go">total 32K</span>
<span class="go">-rw-rw---- 1 charlie charlie  908 Oct  4 15:52 Dockerfile</span>
<span class="go">-rw-rw---- 1 charlie charlie  157 Aug  5 22:37 Makefile</span>
<span class="go">-rw-rw---- 1 charlie charlie 1.2K Aug  5 22:37 README</span>
<span class="go">-rwxr-x--- 1 charlie charlie 9.5K Oct  4 15:58 hello</span>
<span class="go">-rw-rw---- 1 charlie charlie 1.4K Aug  5 22:37 hello.c</span>
<span class="go">-rwxrwx--- 1 charlie charlie  441 Aug  5 22:37 test.sh</span>
</pre></div>
</div>
</section>
<section id="your-software-stored-on-the-host">
<h3><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">12.3.4. </span>Your software stored on the host</a><a class="headerlink" href="#your-software-stored-on-the-host" title="Permalink to this heading">¶</a></h3>
<p>This method leaves your software on the host but compiles it in the image.
This is recommended when your software is volatile or each image user needs a
different version, for example a simulation code under active development.</p>
<p>The general approach is to bind-mount the appropriate directory and then run
the build inside the container. We can re-use the <code class="code docutils literal notranslate"><span class="pre">mpihello</span></code> image to
demonstrate this.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>examples/mpihello
<span class="gp">$ </span>ls<span class="w"> </span>-l
<span class="go">total 20</span>
<span class="go">-rw-rw---- 1 charlie charlie  908 Oct  4 09:52 Dockerfile</span>
<span class="go">-rw-rw---- 1 charlie charlie 1431 Aug  5 16:37 hello.c</span>
<span class="go">-rw-rw---- 1 charlie charlie  157 Aug  5 16:37 Makefile</span>
<span class="go">-rw-rw---- 1 charlie charlie 1172 Aug  5 16:37 README</span>
<span class="gp">$ </span>ch-run<span class="w"> </span>-b<span class="w"> </span>.:/mnt/0<span class="w"> </span>--cd<span class="w"> </span>/mnt/0<span class="w"> </span>/var/tmp/mpihello.sqfs<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>make<span class="w"> </span>mpicc<span class="w"> </span>-std<span class="o">=</span>gnu11<span class="w"> </span>-Wall<span class="w"> </span>hello.c<span class="w"> </span>-o<span class="w"> </span>hello
<span class="gp">$ </span>ls<span class="w"> </span>-l
<span class="go">total 32</span>
<span class="go">-rw-rw---- 1 charlie charlie  908 Oct  4 09:52 Dockerfile</span>
<span class="go">-rwxrwx--- 1 charlie charlie 9632 Oct  4 10:43 hello</span>
<span class="go">-rw-rw---- 1 charlie charlie 1431 Aug  5 16:37 hello.c</span>
<span class="go">-rw-rw---- 1 charlie charlie  157 Aug  5 16:37 Makefile</span>
<span class="go">-rw-rw---- 1 charlie charlie 1172 Aug  5 16:37 README</span>
</pre></div>
</div>
<p>A common use case is to leave a container shell open in one terminal for
building, and then run using a separate container invoked from a different
terminal.</p>
</section>
</section>
<section id="mpi">
<h2><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">12.4. </span>MPI</a><a class="headerlink" href="#mpi" title="Permalink to this heading">¶</a></h2>
<section id="problems-that-best-practices-help-you-avoid">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">12.4.1. </span>Problems that best practices help you avoid</a><a class="headerlink" href="#problems-that-best-practices-help-you-avoid" title="Permalink to this heading">¶</a></h3>
<p>These recommendations are derived from our experience in mitigating container
MPI issues. It is important to note that, despite marketing claims, no single
container implementation has “solved” MPI or is free of warts; the issues are
numerous, multifaceted, and dynamic.</p>
<p>Key concepts and related issues include:</p>
<blockquote>
<div><ol class="arabic">
<li><p><strong>Workload management</strong>. Running applications on HPC clusters requires
resource management and job scheduling. Put simply, resource management
is the act of allocating and restricting compute resources, e.g., CPU and
memory, whereas job scheduling is the act of prioritizing and enforcing
resource management. <em>Both require privileged operations.</em></p>
<p>Some privileged container implementations attempt to provide their own
workload management, often referred to as “container orchestration”.</p>
<p>Charliecloud is lightweight and completely unprivileged. We rely on
existing, reputable and well established HPC workload managers such as
Slurm.</p>
</li>
<li><p><strong>Job launch</strong>. When a multi-node MPI job is launched, each node must
launch a number of containerized processes, i.e., <em>ranks</em>. Doing this
unprivileged and at scale requires interaction between the application
and workload manager. That is, something like Process Management
Interface (PMI) is needed to facilitate the job launch.</p></li>
<li><p><strong>Shared memory</strong>. Processes in separate sibling containers cannot use
single-copy <em>cross-memory attach</em> (CMA), as opposed to double-copy POSIX
or SysV shared memory. The solution is to put all ranks in the <em>same</em>
container with <code class="code docutils literal notranslate"><span class="pre">ch-run</span> <span class="pre">--join</span></code>. (See above for details:
<a class="reference internal" href="faq.html#faq-join"><span class="std std-ref">Communication between ranks on the same node fails</span></a>.)</p></li>
<li><p><strong>Network fabric.</strong> Performant MPI jobs must recognize and use a system’s
high-speed interconnect. Common issues that arise are:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Libraries required to use the interconnect are proprietary or
otherwise unavailable to the container.</p></li>
<li><p>The interconnect is not supported by the container MPI.</p></li>
</ol>
</div></blockquote>
<p>In both cases, the containerized MPI application will either fail or run
significantly slower.</p>
</li>
</ol>
</div></blockquote>
<p>These problems can be avoided, and this section describes our recommendations
to do so.</p>
</section>
<section id="recommendations-tl-dr">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">12.4.2. </span>Recommendations TL;DR</a><a class="headerlink" href="#recommendations-tl-dr" title="Permalink to this heading">¶</a></h3>
<p>Generally, we recommend building a flexible MPI container using:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p><strong>libfabric</strong> to flexibly manage process communication over a diverse
set of network fabrics;</p></li>
<li><p>a parallel <strong>process management interface</strong> (PMI), compatible with the
host workload manager (e.g., PMI2, PMIx, flux-pmi); and</p></li>
<li><p>an <strong>MPI</strong> that supports (1) libfabric and (2) the selected PMI.</p></li>
</ol>
</div></blockquote>
<p>More experienced MPI and unprivileged container users can find success through
MPI replacement (injection); however, such practices are beyond the scope of
this FAQ.</p>
<p>The remaining sections detail the reasoning behind our approach. We recommend
referencing, or directly using, our examples
<code class="code docutils literal notranslate"><span class="pre">examples/Dockerfile.{libfabric,mpich,openmpi}</span></code>.</p>
</section>
<section id="use-libfabric">
<h3><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">12.4.3. </span>Use libfabric</a><a class="headerlink" href="#use-libfabric" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://ofiwg.github.io/libfabric">libfabric</a> (a.k.a. Open Fabrics
Interfaces or OFI) is a low-level communication library that abstracts diverse
networking technologies. It defines <em>providers</em> that implement the mapping
between application-facing software (e.g., MPI) and network specific drivers,
protocols, and hardware. These providers have been co-designed with fabric
hardware and application developers with a focus on HPC needs. libfabric lets
us more easily manage MPI communication over diverse network high-speed
interconnects (a.k.a. <em>fabrics</em>).</p>
<p>From our libfabric example (<code class="code docutils literal notranslate"><span class="pre">examples/Dockerfile.libfabric</span></code>):</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">ARG</span><span class="w"> </span><span class="nv">LIBFABRIC_VERSION</span><span class="o">=</span><span class="m">1</span>.15.1
<span class="k">RUN</span><span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="w"> </span>v<span class="si">${</span><span class="nv">LIBFABRIC_VERSION</span><span class="si">}</span><span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">              </span>https://github.com/ofiwg/libfabric/<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>libfabric<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./autogen.sh<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>x86_64<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">PSM_CONFIG</span><span class="o">=</span>enable<span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="nv">PSM_CONFIG</span><span class="o">=</span>disable<span class="p">;</span><span class="w"> </span><span class="k">fi</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./configure<span class="w"> </span>--prefix<span class="o">=</span>/usr/local<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--disable-opx<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--disable-psm2<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--disable-efa<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--disable-rxm<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--disable-sockets<span class="w"> </span><span class="se">\</span>
<span class="w">                </span><span class="s2">&quot;--</span><span class="si">${</span><span class="nv">PSM_CONFIG</span><span class="si">}</span><span class="s2">-psm3&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--enable-rxm<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--enable-shm<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--enable-tcp<span class="w"> </span><span class="se">\</span>
<span class="w">                </span>--enable-verbs<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>-j<span class="k">$(</span>getconf<span class="w"> </span>_NPROCESSORS_ONLN<span class="k">)</span><span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-Rf<span class="w"> </span>../libfabric*
</pre></div>
</div>
<p>The above compiles libfabric with several “built-in” providers, i.e.
<code class="code docutils literal notranslate"><span class="pre">psm3</span></code> (on x86-64), <code class="code docutils literal notranslate"><span class="pre">rxm</span></code>, <code class="code docutils literal notranslate"><span class="pre">shm</span></code>, <code class="code docutils literal notranslate"><span class="pre">tcp</span></code>, and
<code class="code docutils literal notranslate"><span class="pre">verbs</span></code>, which enables MPI applications to run efficiently over most
verb devices using TCP, IB, OPA, and RoCE protocols.</p>
<p>Two key advantages of using libfabric are: (1) the container’s libfabric can
make use of “external” i.e. dynamic-shared-object (DSO) providers, and
(2) libfabric replacement is simpler than MPI replacement and preserves the
original container MPI. That is, managing host/container ABI compatibility is
difficult and error-prone, so we instead manage the more forgiving libfabric
ABI compatibility.</p>
<p>A DSO provider can be used by a libfabric that did not originally compile it,
i.e., they can be compiled on a target host and later injected into the
container along with any missing shared library dependencies, and used by the
container’s libfabric. To build a libfabric provider as a DSO, add <code class="code docutils literal notranslate"><span class="pre">=dl</span></code>
to its <code class="code docutils literal notranslate"><span class="pre">configure</span></code> argument, e.g., <code class="code docutils literal notranslate"><span class="pre">--with-cxi=dl</span></code>.</p>
<p>A container’s libfabric can also be replaced by a host libfabric. This is a
brittle but usually effective way to give containers access to the Cray
libfabric Slingshot provider <code class="code docutils literal notranslate"><span class="pre">cxi</span></code>.</p>
<p>In Charliecloud, both of these injection operations are currently done with
<code class="code docutils literal notranslate"><span class="pre">ch-fromhost</span></code>, though see <a class="reference external" href="https://github.com/hpc/charliecloud/issues/1861">issue #1861</a>.</p>
</section>
<section id="choose-a-compatible-pmi">
<h3><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">12.4.4. </span>Choose a compatible PMI</a><a class="headerlink" href="#choose-a-compatible-pmi" title="Permalink to this heading">¶</a></h3>
<p>Unprivileged processes, including unprivileged containerized processes, are
unable to independently launch containerized processes on different nodes,
aside from using SSH, which isn’t scalable. We must either (1) rely on a host
supported parallel process management interface (PMI), or (2) achieve
host/container MPI ABI compatibility through unsavory practices such as
complete container MPI replacement.</p>
<p>The preferred PMI implementation, e.g., PMI1, PMI2, OpenPMIx, or flux-pmi,
will be that which is best supported by your host workload manager and
container MPI.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">example/Dockerfile.libfabric</span></code>, we selected <code class="code docutils literal notranslate"><span class="pre">OpenPMIx</span></code> because
(1) it is supported by SLURM, OpenMPI, and MPICH, (2)~it is required for
exascale, and (3) OpenMPI versions 5 and newer will no longer support PMI2.</p>
</section>
<section id="choose-an-mpi-compatible-with-your-libfabric-and-pmi">
<h3><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">12.4.5. </span>Choose an MPI compatible with your libfabric and PMI</a><a class="headerlink" href="#choose-an-mpi-compatible-with-your-libfabric-and-pmi" title="Permalink to this heading">¶</a></h3>
<p>There are various MPI implementations, e.g., OpenMPI, MPICH, MVAPICH2,
Intel-MPI, etc., to consider. We generally recommend OpenMPI; however, your
MPI implementation of choice will ultimately be that which best supports the
libfabric and PMI most compatible with your hardware and workload manager.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="faq.html" class="btn btn-neutral float-left" title="11. Frequently asked questions (FAQ)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dev.html" class="btn btn-neutral float-right" title="13. Contributor’s guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014–2023, Triad National Security, LLC and others.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>