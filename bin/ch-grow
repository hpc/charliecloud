#!/bin/bash

# Wrapper for deprecated ch-grow script. Warn users and pass arguments to
# ch-image after five (5) seconds.

lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
. "${lib}/base.sh"

usage () {
    cat <<'EOF'
usage: ch-grow [-h] [--dependencies] [--no-cache] [-s DIR] [-v] [--version] CMD

Deprecated; see ch-image.
EOF
}

# Kludges to pass our tests.
if [[ ! -x ${ch_bin}/ch-image ]]; then
    # We can't exit 1 here because the executables sane test will fail when
    # ch-image isn't build and ch-grow is executed with zero arguments.
    printf '%s/ch-image not found; did you build?\n' "$ch_bin"
    exit 0
fi
if [[ $# == 0 ]]; then
    usage
    exit 1
fi
for arg in "$@"; do
    if [[ $arg == '--help' || $arg == '-h' ]]; then
        usage
        exit 0
    fi
done

red='\033[0;31m'
nocolor='\033[0m'
warning=$(cat <<'EOF'

WARNING: ch-grow is deprecated and will be removed in a future release; use
ch-image. Forwarding arguments to ch-image after five (5) seconds.
EOF

)

echo -e "${red}${warning}${nocolor}"
echo
echo

sleep 5
"${ch_bin}/ch-image" "$@"
