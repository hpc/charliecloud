#!/bin/sh

LIBEXEC="$(cd "$(dirname "$0")" && pwd)"
. ${LIBEXEC}/base.sh

set -e

usage () {
    cat 1>&2 <<EOF
Download image via docker pull, flatten and unpack it.

Usage:

  $ $(basename $0) DOCKER_IMAGE DIR

You must have sufficient privilege (via sudo) to run the Docker commands.
EOF
    exit ${1:-1}
}

if [ "$1" = "--help" ]; then
    usage 0
fi
if [ "$1" = "--version" ]; then
    version
    exit 0
fi
if [ "$#" -ne 2 ]; then
    usage
fi
DOCKER_IMAGE=$1
DIR=$2

$DOCKER pull $DOCKER_IMAGE
ch-docker2tar $DOCKER_IMAGE $DIR
ch-tar2dir $DIR/$DOCKER_IMAGE.tar.gz $DIR
