#!/bin/bash
# ch-test-scope: standard

# Generate a flattened image tarball using ch-pull2tar and stage it for testing.

set -e

srcdir=$1
tarball_gz="${2}.tar.gz"
workdir=$3

imgtag='alpine:3.9'
tag='ch-pull2tar'

cd "$srcdir"

if ( ! command -v docker &> /dev/null); then
    echo 'docker not found' 1>&2
    exit 65
fi

ch-pull2tar "$imgtag" "$workdir"
mv "${workdir}/${imgtag}.tar.gz" "$tarball_gz" 
