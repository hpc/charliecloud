#!/bin/bash

# Print (on stdout) BATS tests to run doctests on each file in lib/.

set -e -o pipefail

# Ensure reproducible output
export LC_ALL=C

cat <<EOF
# AUTOGENERATED -- DO NOT EDIT

load ../common

setup () {
    scope standard
    [[ \$CH_TEST_BUILDER = ch-image ]] || skip 'ch-image only'
}

EOF


for f in ../lib/*.py; do
    m=$(basename "$f")
    m=${m%%.py}
    if [[ $m == version ]]; then
        continue
    fi
cat <<EOF

@test 'doctest: $m' {
    ./doctest $m
}
EOF
done
